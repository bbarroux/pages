<!DOCTYPE html>
<html lang="en">
<head><title>Oauth2 demo</title></head>
<body>
<h3 id="welcome"></h3>
<h5 id="error"></h5>
<div id="data"></div>
<script type="javascript">

    const server = "https://go.fficaas.net";
    const host = window.location.host;
    const redirectUri = window.location.origin + window.location.pathname;
    const params = new URLSearchParams(window.location.search);
    const tenant = params["tenant"];
    const idp = params["idp"];
    const api = "total-lending/documents/v2/document-types";
    const req = {credentials: "include", cache: "no-cache"};
    const set = (id, text)=>document.getElementById(id).innerText = text;
    const fetchJson = url=>fetch(url, req).then(r=>r.json()).catch(e=>set("message",e));

    if (tenant && idp) {
        document.location = `${server}/signin/${tenant}/${idp}?redirect_uri=${redirectUri}`
    }else {
        init();
    }
    async function init(){
        const user = await fetchJson(`${server}/user/${host}`);
        set("welcome", `Signed in as ${user.sub} (on ${user.tenant} - ${user.idp})`);
        const data = await fetchJson(`${server}/api/${host}/${api}`);
        set("data", data);
    }


</script>
</body>
</html>
